è¿™æ˜¯ä¸€ä¸ªéå¸¸å®ç”¨çš„åŠŸèƒ½å‡çº§ï¼ç›´æ¥è¿æ¥ Google Sheets å¯ä»¥è®©æ•°æ®ç®¡ç†æ›´æ–¹ä¾¿ï¼Œä¸ç”¨æ‹…å¿ƒæµè§ˆå™¨ç¼“å­˜ä¸¢å¤±ã€‚

ä¸ºäº†å®ç°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬éœ€è¦åˆ©ç”¨ **Google Sheets çš„ CSV å¯¼å‡ºæ¥å£**ã€‚

### âš ï¸ é‡è¦å‰ç½®æ­¥éª¤ (å¿…è¯»)
ä¸ºäº†è®©ç½‘é¡µèƒ½è¯»å–æ‚¨çš„è¡¨æ ¼ï¼Œæ‚¨å¿…é¡»ç¡®ä¿è¡¨æ ¼æƒé™æ˜¯å…¬å¼€çš„ï¼š
1.  æ‰“å¼€æ‚¨çš„ Google Sheetã€‚
2.  ç‚¹å‡»å³ä¸Šè§’ **Share (åˆ†äº«)**ã€‚
3.  å°†æƒé™è®¾ç½®ä¸º **"Anyone with the link" (çŸ¥é“é“¾æ¥çš„ä»»ä½•äºº)** -> **"Viewer" (æŸ¥çœ‹è€…)**ã€‚
4.  **æ— éœ€**å‘å¸ƒåˆ° Webï¼Œåªè¦æœ‰æŸ¥çœ‹æƒé™å³å¯ã€‚

---

### ğŸ“Š æ›´æ–°å†…å®¹
1.  **æ–°å¢â€œäº‘åŒæ­¥â€æŒ‰é’®**ï¼šç‚¹å‡»åç›´æ¥ä»æ‚¨æä¾›çš„ Google Sheet æ‹‰å–æ•°æ®ã€‚
2.  **æ™ºèƒ½è§£æ**ï¼šè‡ªåŠ¨è¯†åˆ«è¡¨æ ¼ä¸­çš„ `æ—¥æœŸ`ã€`ä½“é‡`ã€`èŠ±è´¹` åˆ—ï¼ˆæ”¯æŒä¸­æ–‡è¡¨å¤´ï¼‰ã€‚
3.  **æ•°æ®èåˆ**ï¼šæ‹‰å–çš„æ•°æ®ä¼šè‡ªåŠ¨åˆå¹¶åˆ°å½“å‰è®°å½•ä¸­ã€‚

### ğŸ•¹ï¸ æœ€ç»ˆå®Œæ•´ç‰ˆä»£ç  (Pac-Man + Google Sheets)

```html
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>èº«æåƒè±†äºº (äº‘åŒæ­¥ç‰ˆ)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <!-- å¼•å…¥ XLSX ç”¨äºè§£æ Google Sheet CSV -->
    <script src="https://cdn.sheetjs.com/xlsx-0.20.0/package/dist/xlsx.full.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700&display=swap');
        body { font-family: 'Noto Sans SC', sans-serif; background-color: #f1f5f9; -webkit-tap-highlight-color: transparent; }
        [v-cloak] { display: none !important; }
        
        .glass-panel {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.8);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.03);
        }

        .btn-active:active { transform: scale(0.96); opacity: 0.9; }

        /* --- ğŸ•¹ï¸ åƒè±†äººæ¸¸æˆæ ·å¼ --- */
        .game-screen {
            background-color: #1e293b;
            border-radius: 12px;
            padding: 12px;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.3);
            width: 100%;
            max-width: 340px;
            margin: 0 auto;
        }

        .pac-grid {
            display: grid;
            grid-template-columns: repeat(10, 1fr);
            gap: 4px;
        }

        .pac-cell {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .dot {
            width: 6px; height: 6px;
            background-color: #94a3b8;
            border-radius: 50%;
            opacity: 0.5;
        }

        .pacman {
            width: 20px; height: 20px;
            background: #fbbf24;
            border-radius: 50%;
            position: relative;
            z-index: 10;
            animation: chomp 0.3s infinite linear alternate;
        }
        .pacman::after {
            content: ''; position: absolute; top: 0; right: 0;
            width: 100%; height: 100%;
            background: #1e293b;
            clip-path: polygon(100% 30%, 50% 50%, 100% 70%);
            animation: mouth 0.3s infinite linear alternate;
        }
        @keyframes mouth {
            0% { clip-path: polygon(100% 20%, 50% 50%, 100% 80%); }
            100% { clip-path: polygon(100% 45%, 50% 50%, 100% 55%); }
        }

        .target-icon {
            font-size: 16px; color: #f43f5e;
            filter: drop-shadow(0 0 4px rgba(244, 63, 94, 0.5));
            animation: pulse 2s infinite;
        }

        .path-cleared::after {
            content: ''; width: 2px; height: 2px;
            background-color: #334155; border-radius: 50%;
        }

        /* æç¤ºæ¡†åŠ¨ç”» */
        .toast-enter-active, .toast-leave-active { transition: all 0.3s ease; }
        .toast-enter-from, .toast-leave-to { opacity: 0; transform: translateY(-20px); }
        
        /* åŠ è½½æ—‹è½¬ */
        .spin { animation: spin 1s linear infinite; }
        @keyframes spin { 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="text-slate-700">

<div id="app" v-cloak class="min-h-screen p-4 md:p-6 max-w-7xl mx-auto pb-20 md:pb-6">
    
    <!-- é¡¶éƒ¨æ¶ˆæ¯æç¤º -->
    <transition name="toast">
        <div v-if="toastMsg" class="fixed top-4 left-1/2 transform -translate-x-1/2 z-50 bg-slate-800 text-white px-6 py-3 rounded-full shadow-xl text-sm font-medium flex items-center gap-2 whitespace-nowrap">
            <i class="fas fa-info-circle text-amber-400"></i> {{ toastMsg }}
        </div>
    </transition>

    <!-- é¡¶éƒ¨å¯¼èˆª -->
    <header class="mb-6 flex flex-col md:flex-row justify-between items-center gap-4">
        <div class="text-center md:text-left">
            <h1 class="text-2xl md:text-3xl font-bold text-slate-800 bg-clip-text text-transparent bg-gradient-to-r from-amber-500 to-orange-600">
                <i class="fas fa-ghost mr-2 text-amber-500"></i>èº«æåƒè±†äºº
            </h1>
            <p class="text-slate-500 mt-1 text-xs md:text-sm">Google Sheets äº‘ç«¯åŒæ­¥ç‰ˆ</p>
        </div>
        
        <div class="flex gap-2 w-full md:w-auto justify-center items-center flex-wrap">
            <!-- Google Sheets åŒæ­¥æŒ‰é’® -->
            <button @click="syncGoogleSheet" :disabled="isLoading" class="btn-active px-4 py-2 bg-green-600 text-white rounded-lg shadow-lg shadow-green-200 text-sm font-medium flex items-center gap-2">
                <i class="fas" :class="isLoading ? 'fa-spinner spin' : 'fa-cloud-download-alt'"></i> 
                <span class="hidden md:inline">åŒæ­¥ Google Sheet</span><span class="md:hidden">åŒæ­¥</span>
            </button>

            <button @click="generateMagicLink" class="btn-active px-3 py-2 bg-indigo-500 text-white rounded-lg shadow-sm text-sm" title="ä¿å­˜ä¸ºé“¾æ¥">
                <i class="fas fa-link"></i>
            </button>
            <button @click="downloadTemplate" class="btn-active px-3 py-2 bg-white border border-slate-200 text-slate-600 rounded-lg shadow-sm text-sm" title="ä¸‹è½½Excel">
                <i class="fas fa-file-excel"></i>
            </button>
            <button @click="resetData" class="btn-active px-3 py-2 bg-rose-50 text-rose-500 border border-rose-100 rounded-lg text-sm" title="æ¸…ç©º">
                <i class="fas fa-trash"></i>
            </button>
        </div>
    </header>

    <div class="grid grid-cols-1 lg:grid-cols-12 gap-4 md:gap-6">
        
        <!-- å·¦ä¾§ï¼šæ“ä½œåŒº -->
        <div class="lg:col-span-4 space-y-4 md:space-y-6 order-2 lg:order-1">
            <!-- æ‰“å¡å¡ç‰‡ -->
            <div class="glass-panel rounded-2xl p-5 border-t-4 border-amber-400 shadow-lg">
                <h3 class="text-lg font-bold text-slate-800 mb-4 flex items-center justify-between">
                    <span><i class="fas fa-pen-fancy text-amber-500 mr-2"></i>ä»Šæ—¥æ‰“å¡</span>
                    <span class="text-xs font-normal text-slate-400 bg-slate-100 px-2 py-1 rounded">{{ newRecord.date }}</span>
                </h3>
                <form @submit.prevent="addRecord" class="space-y-4">
                    <div class="grid grid-cols-2 gap-3">
                        <div>
                            <label class="text-xs text-slate-500 font-medium ml-1">ä½“é‡ (KG)</label>
                            <input type="number" step="0.01" v-model.number="newRecord.weight" required placeholder="0.0" class="w-full bg-slate-50 border border-slate-200 rounded-xl px-4 py-3 outline-none focus:ring-2 focus:ring-amber-400 focus:bg-white transition text-lg font-bold text-slate-700">
                        </div>
                        <div>
                            <label class="text-xs text-slate-500 font-medium ml-1">èŠ±è´¹ (å…ƒ)</label>
                            <input type="number" step="0.1" v-model.number="newRecord.cost" placeholder="0" class="w-full bg-slate-50 border border-slate-200 rounded-xl px-4 py-3 outline-none focus:ring-2 focus:ring-amber-400 focus:bg-white transition text-lg text-slate-700">
                        </div>
                    </div>
                    <details class="group">
                        <summary class="list-none text-xs text-center text-indigo-500 cursor-pointer py-1">
                            è¡¥å½•å…¶ä»–æ—¥æœŸ <i class="fas fa-chevron-down text-[10px]"></i>
                        </summary>
                        <input type="date" v-model="newRecord.date" required class="mt-2 w-full bg-white border border-slate-200 rounded-lg px-3 py-2 text-sm">
                    </details>
                    <button type="submit" class="btn-active w-full bg-gradient-to-r from-amber-500 to-orange-500 text-white font-bold py-3.5 rounded-xl shadow-lg shadow-amber-200 transition flex items-center justify-center gap-2">
                        <i class="fas fa-check-circle"></i> æäº¤è®°å½•
                    </button>
                </form>
            </div>

            <!-- ç›®æ ‡è®¾å®š -->
            <div class="glass-panel rounded-2xl p-4">
                <div @click="showSettings = !showSettings" class="flex justify-between items-center cursor-pointer">
                    <h3 class="text-sm font-bold text-slate-500 uppercase tracking-wider">ğŸ¯ ç›®æ ‡è®¾å®š</h3>
                    <i class="fas fa-chevron-down transition-transform duration-300 text-slate-400" :class="{'rotate-180': showSettings}"></i>
                </div>
                <div v-if="showSettings" class="mt-4 grid grid-cols-2 gap-3 animate-fade-in">
                    <div>
                        <label class="block text-xs text-slate-400 mb-1">åˆå§‹ (KG)</label>
                        <input type="number" v-model.number="settings.initialWeight" class="w-full bg-slate-50 border border-slate-200 rounded-lg px-3 py-2 text-sm">
                    </div>
                    <div>
                        <label class="block text-xs text-slate-400 mb-1">ç›®æ ‡ (KG)</label>
                        <input type="number" v-model.number="settings.targetWeight" class="w-full bg-slate-50 border border-slate-200 rounded-lg px-3 py-2 text-sm">
                    </div>
                    <button @click="saveSettings" class="col-span-2 mt-2 btn-active bg-slate-800 text-white text-xs py-2 rounded-lg">ä¿å­˜è®¾å®š</button>
                </div>
            </div>
        </div>

        <!-- ä¸­é—´ï¼šåƒè±†äººæ¸¸æˆåŒº (LG: 4/12) -->
        <div class="lg:col-span-4 order-1 lg:order-2">
            <div class="glass-panel rounded-2xl p-5 h-full flex flex-col items-center justify-center relative min-h-[450px]">
                
                <!-- é¡¶éƒ¨æ•°æ® -->
                <div class="w-full flex justify-between items-end mb-4 px-1">
                    <div>
                        <p class="text-xs text-slate-400 font-medium">å½“å‰ä½“é‡</p>
                        <p class="text-2xl font-bold text-slate-800">{{ currentWeight }}<span class="text-sm font-normal text-slate-500">kg</span></p>
                    </div>
                    <div class="text-right">
                        <p class="text-xs text-slate-400 font-medium">å…³å¡è¿›åº¦</p>
                        <p class="text-xl font-bold text-amber-500">{{ progressPercent }}%</p>
                    </div>
                </div>

                <!-- ğŸ•¹ï¸ æ¸¸æˆå±å¹• -->
                <div class="game-screen">
                    <div class="pac-grid">
                        <div v-for="n in 100" :key="n" class="pac-cell" :class="{'path-cleared': n < currentStep}">
                            <i v-if="n === 100" class="fas fa-flag-checkered target-icon" title="ç›®æ ‡"></i>
                            <div v-else-if="n === currentStep" class="pacman" title="æˆ‘åœ¨è¿™é‡Œ"></div>
                            <div v-else-if="n > currentStep" class="dot"></div>
                        </div>
                    </div>
                </div>

                <!-- é¢„æµ‹èƒ¶å›Š -->
                <div class="mt-6 w-full">
                    <div v-if="prediction.status === 'normal'" class="bg-white border border-slate-200 text-slate-600 p-3 rounded-xl shadow-sm flex justify-between items-center">
                        <div class="text-left">
                            <p class="text-[10px] text-slate-400 uppercase tracking-wide">é¢„è®¡é€šå…³</p>
                            <p class="font-bold text-sm text-indigo-600">{{ prediction.date }}</p>
                        </div>
                        <div class="text-right">
                            <p class="text-xl font-bold leading-none text-slate-800">{{ prediction.days }}<span class="text-xs font-normal text-slate-400 ml-1">å¤©å</span></p>
                        </div>
                    </div>
                    <div v-else-if="prediction.status === 'done'" class="bg-gradient-to-r from-amber-400 to-orange-500 text-white p-3 rounded-xl shadow-lg text-center animate-bounce">
                        <p class="font-bold text-sm"><i class="fas fa-trophy mr-2"></i>YOU WIN! ç›®æ ‡è¾¾æˆ</p>
                    </div>
                    <div v-else class="bg-slate-50 text-slate-400 p-3 rounded-xl text-center text-xs border border-slate-100">
                        <i class="fas fa-gamepad mr-1"></i> {{ prediction.msg }}
                    </div>
                </div>

                <!-- åº•éƒ¨æ•°æ® -->
                <div class="mt-4 w-full grid grid-cols-2 gap-3 text-center">
                    <div class="bg-slate-50 p-2 rounded-lg border border-slate-100">
                        <p class="text-[10px] text-slate-400">å·²æ¶ˆé™¤</p>
                        <p class="text-base font-bold text-emerald-600">{{ lostJin }} <span class="text-[10px] text-slate-400">æ–¤</span></p>
                    </div>
                    <div class="bg-slate-50 p-2 rounded-lg border border-slate-100">
                        <p class="text-[10px] text-slate-400">å‰©ä½™è±†å­</p>
                        <p class="text-base font-bold text-rose-500">{{ remainingJin }} <span class="text-[10px] text-slate-400">æ–¤</span></p>
                    </div>
                </div>
            </div>
        </div>

        <!-- å³ä¾§ï¼šå›¾è¡¨ (LG: 4/12) -->
        <div class="lg:col-span-4 order-3">
            <div class="glass-panel rounded-2xl p-4 h-full flex flex-col min-h-[350px]">
                <div class="flex justify-between items-center mb-2 px-1">
                    <h3 class="font-bold text-slate-800">è¶‹åŠ¿åˆ†æ</h3>
                    <span class="text-[10px] text-slate-400 bg-slate-100 px-2 py-1 rounded-full">
                        <i class="fas fa-chart-area mr-1"></i>å¯è§†åŒ–
                    </span>
                </div>
                <div v-if="records.length > 0" id="mainChart" class="w-full flex-1 rounded-xl overflow-hidden"></div>
                <div v-else class="flex-1 flex flex-col items-center justify-center text-slate-300 border-2 border-dashed border-slate-200 rounded-xl">
                    <i class="fas fa-chart-line text-4xl mb-2 opacity-50"></i>
                    <p class="text-sm">æ·»åŠ æ•°æ®åç”Ÿæˆå›¾è¡¨</p>
                </div>
            </div>
        </div>
    </div>

    <!-- åº•éƒ¨ï¼šè¯¦ç»†åˆ—è¡¨ -->
    <section class="mt-6 glass-panel rounded-2xl overflow-hidden">
        <div class="p-4 border-b border-slate-100 flex justify-between items-center bg-slate-50/50">
            <h3 class="font-bold text-slate-800">è¯¦ç»†è®°å½•</h3>
            <div class="text-xs text-slate-500">å…± {{ records.length }} æ¡</div>
        </div>
        <div class="overflow-x-auto">
            <table class="w-full text-left border-collapse min-w-[350px]">
                <thead>
                    <tr class="text-xs text-slate-400 bg-slate-50">
                        <th class="py-3 pl-4 font-medium">æ—¥æœŸ</th>
                        <th class="py-3 font-medium">ä½“é‡</th>
                        <th class="py-3 font-medium">å˜åŒ–</th>
                        <th class="py-3 font-medium">èŠ±è´¹</th>
                        <th class="py-3 text-right pr-4 font-medium">æ“ä½œ</th>
                    </tr>
                </thead>
                <tbody class="text-sm text-slate-600">
                    <tr v-for="(record, index) in sortedRecords" :key="index" class="border-b border-slate-50 hover:bg-slate-50 transition">
                        <td class="py-3 pl-4 font-mono text-xs md:text-sm">{{ record.date }}</td>
                        <td class="py-3 font-bold">{{ record.weight }}</td>
                        <td class="py-3">
                            <span :class="getChangeClass(index)" class="text-xs md:text-sm">{{ getChange(index) }}</span>
                        </td>
                        <td class="py-3 text-slate-400 text-xs">Â¥{{ record.cost }}</td>
                        <td class="py-3 text-right pr-4">
                            <button @click="deleteRecord(record.id)" class="text-slate-300 hover:text-rose-500 p-2">
                                <i class="fas fa-times"></i>
                            </button>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </section>

</div>

<script>
const { createApp } = Vue;

const app = createApp({
    data() {
        return {
            showSettings: true,
            toastMsg: '',
            isLoading: false,
            // æ‚¨çš„ Google Sheet ID (ä»é“¾æ¥ä¸­æå–)
            sheetId: '1Inbi59ix1oVaUqrXxZVev6uiy6eUZRMuqEV5ZG_tQDA',
            settings: { initialWeight: 80, targetWeight: 65 },
            newRecord: { date: new Date().toISOString().split('T')[0], weight: '', cost: '' },
            records: [],
            chartInstance: null
        }
    },
    computed: {
        sortedRecords() { return [...this.records].sort((a, b) => new Date(b.date) - new Date(a.date)); },
        timelineRecords() { return [...this.records].sort((a, b) => new Date(a.date) - new Date(b.date)); },
        currentWeight() {
            if (this.records.length === 0) return this.settings.initialWeight;
            return this.timelineRecords[this.timelineRecords.length - 1].weight;
        },
        lostJin() {
            let lost = (this.settings.initialWeight - this.currentWeight) * 2;
            return lost > 0 ? lost.toFixed(1) : 0;
        },
        remainingJin() {
            let rem = (this.currentWeight - this.settings.targetWeight) * 2;
            return rem > 0 ? rem.toFixed(1) : 0;
        },
        progressPercent() {
            const totalToLose = this.settings.initialWeight - this.settings.targetWeight;
            const alreadyLost = this.settings.initialWeight - this.currentWeight;
            if (totalToLose <= 0) return 100;
            let pct = (alreadyLost / totalToLose) * 100;
            return Math.min(Math.max(pct, 0), 100).toFixed(1);
        },
        currentStep() { return Math.floor(this.progressPercent); },
        prediction() {
            const recs = this.timelineRecords;
            if (this.currentWeight <= this.settings.targetWeight) return { status: 'done' };
            if (recs.length < 2) return { status: 'waiting', msg: 'å†è®°å½•ä¸€å¤©ä»¥é¢„æµ‹' };
            
            const first = recs[0];
            const last = recs[recs.length - 1];
            const dayDiff = (new Date(last.date) - new Date(first.date)) / (1000 * 3600 * 24);
            const weightDiff = first.weight - last.weight;
            
            if (dayDiff < 1) return { status: 'waiting', msg: 'éœ€æ›´å¤šæ—¶é—´è·¨åº¦' };
            if (weightDiff <= 0) return { status: 'waiting', msg: 'å½“å‰å‘ˆä¸Šå‡è¶‹åŠ¿' };
            
            const dailyRate = weightDiff / dayDiff;
            const remainingWeight = last.weight - this.settings.targetWeight;
            const daysLeft = Math.ceil(remainingWeight / dailyRate);
            
            const targetDate = new Date();
            targetDate.setDate(targetDate.getDate() + daysLeft);
            const dateStr = `${targetDate.getFullYear()}-${(targetDate.getMonth()+1).toString().padStart(2,'0')}-${targetDate.getDate().toString().padStart(2,'0')}`;
            
            if (daysLeft > 1000) return { status: 'waiting', msg: 'æ—¶é—´è¿‡é•¿' };
            return { status: 'normal', days: daysLeft, date: dateStr };
        }
    },
    mounted() {
        this.checkUrlData();
        if(window.innerWidth < 768) this.showSettings = false;
        window.addEventListener('resize', () => { this.chartInstance && this.chartInstance.resize(); });
    },
    methods: {
        showToast(msg) {
            this.toastMsg = msg;
            setTimeout(() => this.toastMsg = '', 3000);
        },
        // --- Google Sheets åŒæ­¥é€»è¾‘ ---
        async syncGoogleSheet() {
            this.isLoading = true;
            const url = `https://docs.google.com/spreadsheets/d/${this.sheetId}/gviz/tq?tqx=out:csv`;
            
            try {
                const response = await fetch(url);
                if (!response.ok) throw new Error('ç½‘ç»œè¯·æ±‚å¤±è´¥');
                
                const csvText = await response.text();
                
                // ä½¿ç”¨ XLSX è§£æ CSV
                const workbook = XLSX.read(csvText, { type: 'string' });
                const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                const jsonData = XLSX.utils.sheet_to_json(firstSheet, { header: 1 }); // æ•°ç»„æ•°ç»„æ ¼å¼

                if (jsonData.length < 2) {
                    this.showToast('è¡¨æ ¼ä¼¼ä¹æ˜¯ç©ºçš„');
                    return;
                }

                // ç®€å•çš„åˆ—æ˜ å°„ (å‡è®¾é¡ºåº: æ—¥æœŸ, ä½“é‡, èŠ±è´¹)
                // æˆ–è€…æ ¹æ®è¡¨å¤´åç§°æŸ¥æ‰¾ç´¢å¼•
                const headers = jsonData[0].map(h => h.toString().trim());
                const dateIdx = headers.findIndex(h => h.includes('æ—¥æœŸ') || h.includes('Date'));
                const weightIdx = headers.findIndex(h => h.includes('ä½“é‡') || h.includes('Weight'));
                const costIdx = headers.findIndex(h => h.includes('èŠ±è´¹') || h.includes('Cost'));

                if (dateIdx === -1 || weightIdx === -1) {
                    throw new Error('æœªæ‰¾åˆ°"æ—¥æœŸ"æˆ–"ä½“é‡"åˆ—');
                }

                let addedCount = 0;
                
                // ä»ç¬¬äºŒè¡Œå¼€å§‹éå†
                for (let i = 1; i < jsonData.length; i++) {
                    const row = jsonData[i];
                    if (!row[dateIdx] || !row[weightIdx]) continue;

                    let dateStr = row[dateIdx];
                    // å¤„ç†æ—¥æœŸæ ¼å¼ (å¦‚æœæ˜¯Excelåºåˆ—å·åˆ™è½¬æ¢ï¼Œå¦‚æœæ˜¯å­—ç¬¦ä¸²åˆ™å°è¯•è§£æ)
                    // ç®€å•å¤„ç†ï¼šå‡è®¾æ˜¯å­—ç¬¦ä¸²æ ¼å¼ YYYY-MM-DD æˆ– YYYY/MM/DD
                    let dateObj = new Date(dateStr);
                    if (isNaN(dateObj.getTime())) continue;
                    
                    const fmtDate = dateObj.toISOString().split('T')[0];
                    const weightVal = parseFloat(row[weightIdx]);
                    const costVal = costIdx !== -1 ? (parseFloat(row[costIdx]) || 0) : 0;

                    // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨
                    const exists = this.records.some(r => r.date === fmtDate);
                    if (!exists) {
                        this.records.push({
                            id: Date.now() + i,
                            date: fmtDate,
                            weight: weightVal,
                            cost: costVal
                        });
                        addedCount++;
                    }
                }

                if (addedCount > 0) {
                    this.saveData();
                    this.showToast(`æˆåŠŸåŒæ­¥ ${addedCount} æ¡æ–°è®°å½•ï¼`);
                } else {
                    this.showToast('æ•°æ®å·²æ˜¯æœ€æ–°');
                }

            } catch (error) {
                console.error(error);
                this.showToast('åŒæ­¥å¤±è´¥ï¼šè¯·ç¡®ä¿è¡¨æ ¼æƒé™ä¸º"çŸ¥é“é“¾æ¥è€…å¯æŸ¥çœ‹"');
            } finally {
                this.isLoading = false;
            }
        },
        // ---------------------------
        
        generateMagicLink() {
            try {
                const dataStr = JSON.stringify({ settings: this.settings, records: this.records });
                const encoded = btoa(encodeURIComponent(dataStr));
                const newUrl = `${window.location.origin}${window.location.pathname}?data=${encoded}`;
                navigator.clipboard.writeText(newUrl).then(() => {
                    this.showToast('é“¾æ¥å·²å¤åˆ¶ï¼');
                });
                window.history.pushState({path:newUrl}, '', newUrl);
            } catch(e) {
                this.showToast('æ•°æ®é‡å¤ªå¤§');
            }
        },
        checkUrlData() {
            const params = new URLSearchParams(window.location.search);
            const dataStr = params.get('data');
            if (dataStr) {
                try {
                    const jsonStr = decodeURIComponent(atob(dataStr));
                    const parsed = JSON.parse(jsonStr);
                    if(confirm('æ£€æµ‹åˆ°é“¾æ¥ä¸­åŒ…å«å†å²æ•°æ®ï¼Œæ˜¯å¦åŠ è½½ï¼Ÿ(å°†è¦†ç›–å½“å‰ç¼“å­˜)')) {
                        this.settings = parsed.settings || this.settings;
                        this.records = parsed.records || [];
                        this.saveData();
                        this.showToast('æ•°æ®å·²æ¢å¤ï¼');
                        const cleanUrl = window.location.origin + window.location.pathname;
                        window.history.replaceState({}, '', cleanUrl);
                    }
                } catch (e) {}
            } else {
                this.loadData();
            }
        },
        saveSettings() {
            this.saveData();
            this.showSettings = false;
            this.showToast('è®¾å®šå·²ä¿å­˜');
        },
        addRecord() {
            if (!this.newRecord.weight || !this.newRecord.date) return;
            const existingIndex = this.records.findIndex(r => r.date === this.newRecord.date);
            const record = { id: Date.now(), date: this.newRecord.date, weight: this.newRecord.weight, cost: this.newRecord.cost || 0 };
            
            if (existingIndex !== -1) {
                if(!confirm('è¦†ç›–å½“å¤©è®°å½•ï¼Ÿ')) return;
                this.records[existingIndex] = record;
            } else {
                this.records.push(record);
            }
            this.saveData();
            this.newRecord.cost = '';
            setTimeout(() => {
                document.getElementById('mainChart')?.scrollIntoView({behavior: 'smooth', block: 'center'});
            }, 300);
        },
        deleteRecord(id) {
            if(confirm('åˆ é™¤æ­¤æ¡è®°å½•ï¼Ÿ')) {
                this.records = this.records.filter(r => r.id !== id);
                this.saveData();
            }
        },
        resetData() {
            if(confirm('ç¡®å®šæ¸…ç©ºæ‰€æœ‰æ•°æ®ï¼Ÿ')) {
                this.records = [];
                this.saveData();
            }
        },
        getChange(index) {
            const current = this.sortedRecords[index];
            const prev = this.sortedRecords[index + 1];
            let diff = prev ? (prev.weight - current.weight) * 2 : (this.settings.initialWeight - current.weight) * 2;
            if (diff === 0) return '-';
            return (diff > 0 ? 'â†“' : 'â†‘') + Math.abs(diff).toFixed(1);
        },
        getChangeClass(index) {
            const isDown = this.getChange(index).includes('â†“');
            return isDown ? 'text-emerald-500 font-bold' : 'text-rose-500 font-bold';
        },
        saveData() {
            localStorage.setItem('weightTrackerData', JSON.stringify({ settings: this.settings, records: this.records }));
            this.$nextTick(() => { this.initChart(); });
        },
        loadData() {
            try {
                const saved = localStorage.getItem('weightTrackerData');
                if (saved) {
                    const parsed = JSON.parse(saved);
                    this.settings = parsed.settings || this.settings;
                    this.records = parsed.records || [];
                }
            } catch (e) {}
            this.$nextTick(() => { this.initChart(); });
        },
        initChart() {
            if (this.records.length === 0) {
                if(this.chartInstance) { this.chartInstance.dispose(); this.chartInstance = null; }
                return;
            }
            const chartDom = document.getElementById('mainChart');
            if (!chartDom) return;
            if (!this.chartInstance) this.chartInstance = echarts.init(chartDom);

            const data = this.timelineRecords;
            const dates = data.map(r => r.date); // Use full date for better clarity
            const weights = data.map(r => r.weight);
            
            const option = {
                tooltip: { trigger: 'axis', confine: true },
                grid: { left: '12%', right: '5%', bottom: '10%', top: '10%' },
                xAxis: { type: 'category', data: dates, boundaryGap: false, axisLine: { lineStyle: { color: '#cbd5e1' } } },
                yAxis: { 
                    type: 'value', 
                    scale: true, 
                    splitLine: { lineStyle: { type: 'dashed', color: '#f1f5f9' } },
                    axisLabel: { color: '#64748b' }
                },
                series: [{
                    name: 'ä½“é‡',
                    type: 'line',
                    smooth: true,
                    symbol: 'circle',
                    symbolSize: 6,
                    data: weights,
                    itemStyle: { color: '#f59e0b' },
                    lineStyle: { color: '#f59e0b' },
                    areaStyle: {
                        color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
                            { offset: 0, color: 'rgba(245, 158, 11, 0.3)' },
                            { offset: 1, color: 'rgba(245, 158, 11, 0.0)' }
                        ])
                    },
                    markLine: {
                        data: [{ yAxis: this.settings.targetWeight, name: 'ç›®æ ‡' }],
                        lineStyle: { color: '#14b8a6', type: 'dashed' },
                        label: { show: false }
                    }
                }]
            };
            this.chartInstance.setOption(option);
        },
        downloadTemplate() {
            const ws = XLSX.utils.json_to_sheet([{ "æ—¥æœŸ": "2023-10-01", "ä½“é‡": 75.5, "èŠ±è´¹": 0 }]);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "Sheet1");
            XLSX.writeFile(wb, "å‡é‡è®°å½•æ¨¡æ¿.xlsx");
        }
    }
});

app.mount('#app');
</script>
</body>
</html>
```
