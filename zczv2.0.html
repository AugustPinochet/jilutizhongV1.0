æŠ±æ­‰ï¼Œä¹‹å‰çš„ç‰ˆæœ¬ä¸ºäº†èŠ‚çœç©ºé—´æŠŠå¤‡æ³¨åˆå¹¶åœ¨æ—¥æœŸä¸‹æ–¹ï¼Œå¯èƒ½å¯¼è‡´ä¸å¤Ÿç›´è§‚ã€‚

è¿™æ˜¯**ä¿®å¤åçš„ç»ˆæç‰ˆ**ã€‚æˆ‘æŠŠ**â€œå¤‡æ³¨â€**æ‹†åˆ†æˆäº†**ç‹¬ç«‹çš„ä¸€åˆ—**ï¼Œç°åœ¨æ‚¨å¯ä»¥éå¸¸æ¸…æ¥šåœ°åœ¨è¡¨æ ¼ä¸­çœ‹åˆ°å®ƒã€‚

### ğŸ› ï¸ ä¿®å¤ä¸å¢å¼ºç‚¹
1.  **ç‹¬ç«‹â€œå¤‡æ³¨â€åˆ—**ï¼šå†å²è®°å½•è¡¨æ ¼ç°åœ¨æœ‰ä¸“é—¨çš„ `å¤‡æ³¨` ä¸€æ ï¼Œä¸å†å’Œæ—¥æœŸæ··åœ¨ä¸€èµ·ã€‚
2.  **è¾“å…¥ä¼˜åŒ–**ï¼šå½•å…¥åŒºåŸŸç°åœ¨æœ‰ç‹¬ç«‹çš„å¤‡æ³¨è¾“å…¥æ¡†ï¼Œæ”¯æŒå›è½¦ä¿å­˜ã€‚
3.  **Excel å¯¼å…¥æ”¯æŒ**ï¼šæ”¯æŒè¯†åˆ« Excel è¡¨æ ¼ä¸­çš„ `å¤‡æ³¨`ã€`Note`ã€`Remark` åˆ—å¹¶è‡ªåŠ¨å¯¼å…¥ã€‚
4.  **å®‰å…¨åŒæ­¥**ï¼šä¿ç•™äº†â€œé˜²è¦†ç›–â€å®‰å…¨é”å’Œâ€œä»…æ‹‰å–â€æŒ‰é’®ã€‚

---

### â˜ï¸ å®Œæ•´ä»£ç  (å¤åˆ¶ä¿å­˜ä¸º .html)

```html
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>èº«æåƒè±†äºº (å¤‡æ³¨ä¿®å¤ç‰ˆ)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <script src="https://cdn.sheetjs.com/xlsx-0.20.0/package/dist/xlsx.full.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <style>
        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; 
            background-color: #f8fafc; 
            color: #334155; 
        }
        [v-cloak] { display: none; }
        
        .glass {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 1);
            box-shadow: 0 10px 30px -10px rgba(0, 0, 0, 0.1);
        }

        .fade-enter-active, .fade-leave-active { transition: opacity 0.3s ease; }
        .fade-enter-from, .fade-leave-to { opacity: 0; }

        /* --- åƒè±†äººç½‘æ ¼ --- */
        .pac-grid { display: grid; grid-template-columns: repeat(10, 1fr); gap: 5px; max-width: 320px; margin: 0 auto; }
        .pac-cell { 
            aspect-ratio: 1; display: flex; align-items: center; justify-content: center; 
            background: #f1f5f9; border-radius: 6px; transition: all 0.3s;
        }
        .pac-cell.eaten { background-color: #ffedd5; box-shadow: inset 0 0 0 1px #fed7aa; }
        .dot { width: 6px; height: 6px; background-color: #cbd5e1; border-radius: 50%; }
        .pacman { 
            width: 24px; height: 24px; background: #f59e0b; border-radius: 50%; 
            position: relative; z-index: 10;
            box-shadow: 0 4px 12px rgba(245, 158, 11, 0.5);
            animation: chomp 0.3s infinite alternate;
        }
        @keyframes chomp { from { clip-path: polygon(100% 0%, 100% 100%, 50% 50%); } to { clip-path: polygon(100% 20%, 100% 80%, 50% 50%); } }
        
        .input-light { background: #ffffff; border: 1px solid #e2e8f0; color: #1e293b; transition: all 0.3s; }
        .input-light:focus { border-color: #6366f1; outline: none; box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1); }
        
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
    </style>
</head>
<body>

<div id="app" v-cloak class="min-h-screen p-4 max-w-5xl mx-auto pb-20">
    
    <!-- é€šçŸ¥ -->
    <div v-if="msg" class="fixed top-6 left-1/2 -translate-x-1/2 z-50 px-6 py-3 rounded-full shadow-xl text-sm font-bold flex items-center gap-2 transition-all duration-300 border border-white/20"
         :class="msgType === 'success' ? 'bg-emerald-500 text-white' : 'bg-rose-500 text-white'">
        <i class="fas" :class="msgType === 'success' ? 'fa-check' : 'fa-exclamation-circle'"></i> {{ msg }}
    </div>

    <!-- å¤´éƒ¨ -->
    <header class="flex justify-between items-center mb-8">
        <div>
            <h1 class="text-2xl font-black text-slate-800 tracking-tight">
                <span class="text-amber-500 mr-2"><i class="fas fa-ghost"></i></span>èº«æåƒè±†äºº
            </h1>
            <p class="text-xs text-slate-500 mt-1 font-medium pl-1">
                <i class="fab fa-github mr-1"></i> å¤‡æ³¨ç‹¬ç«‹åˆ—ç‰ˆ
            </p>
        </div>
        <div class="flex gap-2">
            <input type="file" ref="fileInput" @change="handleExcelUpload" accept=".xlsx, .xls, .csv" class="hidden">
            <button @click="$refs.fileInput.click()" :disabled="loading" class="bg-white hover:bg-slate-50 text-slate-600 border border-slate-200 px-4 py-2 rounded-xl text-sm font-bold transition flex items-center gap-2 shadow-sm">
                <i class="fas fa-file-excel text-emerald-500"></i> <span class="hidden sm:inline">å¯¼å…¥</span>
            </button>
            <button @click="toggleConfig" class="w-10 h-10 rounded-xl bg-white border border-slate-200 hover:bg-slate-50 flex items-center justify-center text-slate-400 hover:text-indigo-500 transition shadow-sm">
                <i class="fas fa-cog" :class="{'fa-spin': loading}"></i>
            </button>
        </div>
    </header>

    <!-- é…ç½®é¢æ¿ -->
    <transition name="fade">
        <div v-if="showConfig" class="glass p-6 rounded-3xl mb-8 border-l-4 border-indigo-500 shadow-lg">
            <div class="flex justify-between items-center mb-4">
                <h3 class="font-bold text-lg text-slate-700 flex items-center gap-2">
                    <i class="fas fa-sliders-h text-indigo-500"></i> è®¾ç½®
                </h3>
            </div>
            <div class="space-y-4">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div><label class="block text-xs font-bold text-slate-400 mb-1">GitHub Token</label><input type="password" v-model="config.token" class="w-full input-light rounded-lg px-3 py-2 text-sm font-mono"></div>
                    <div><label class="block text-xs font-bold text-slate-400 mb-1">Gist ID</label><input type="text" v-model="config.gistId" class="w-full input-light rounded-lg px-3 py-2 text-sm font-mono"></div>
                </div>
                <div class="grid grid-cols-2 gap-4 p-4 bg-slate-50 rounded-2xl border border-slate-100">
                    <div><label class="text-xs font-bold text-slate-400">åˆå§‹ä½“é‡ (kg)</label><input type="number" v-model.number="config.start" class="w-full input-light rounded-lg px-3 py-2 mt-1 font-bold text-slate-700"></div>
                    <div><label class="text-xs font-bold text-slate-400">ç›®æ ‡ä½“é‡ (kg)</label><input type="number" v-model.number="config.target" class="w-full input-light rounded-lg px-3 py-2 mt-1 font-bold text-indigo-600"></div>
                </div>
                
                <div class="flex flex-col sm:flex-row justify-end gap-3 mt-4 pt-4 border-t border-slate-100">
                    <button @click="pullData" :disabled="loading" class="px-5 py-2.5 rounded-lg bg-slate-100 hover:bg-slate-200 text-slate-600 text-sm font-bold transition flex items-center justify-center gap-2">
                        <i class="fas fa-cloud-download-alt"></i> ä»…æ‹‰å–äº‘ç«¯æ•°æ®
                    </button>
                    <button @click="saveConfigAndPush" class="px-6 py-2.5 rounded-lg bg-indigo-600 hover:bg-indigo-500 text-white text-sm font-bold shadow-lg shadow-indigo-200 transition flex items-center justify-center gap-2">
                        <i class="fas fa-save"></i> ä¿å­˜å¹¶åŒæ­¥
                    </button>
                </div>
            </div>
        </div>
    </transition>

    <!-- ä¸»ç•Œé¢ -->
    <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
        
        <!-- å·¦ä¾§ï¼šä»ªè¡¨ç›˜ -->
        <div class="lg:col-span-5 glass rounded-3xl p-8 flex flex-col items-center relative overflow-hidden border border-white">
            <div class="absolute top-0 left-0 w-full h-2 bg-gradient-to-r from-amber-300 via-orange-400 to-rose-400"></div>
            
            <div class="text-center mb-8 mt-2">
                <p class="text-slate-400 text-xs font-bold uppercase tracking-wider mb-2">Current Weight</p>
                <div class="text-6xl font-black text-slate-800 tracking-tighter">
                    {{ currentWeight }}<span class="text-xl text-slate-400 ml-1 font-normal">kg</span>
                </div>
                <div class="mt-3 inline-flex items-center gap-2 bg-indigo-50 text-indigo-600 px-3 py-1 rounded-full text-xs font-bold border border-indigo-100">
                    <i class="fas fa-calendar-alt"></i> é¢„è®¡è¾¾æˆ: {{ predictedDate }}
                </div>
            </div>

            <div class="pac-grid mb-8 w-full">
                <div v-for="n in 100" :key="n" class="pac-cell" :class="{'eaten': n < currentStep}">
                    <div v-if="n === currentStep" class="pacman"></div>
                    <div v-else-if="n === 100" class="fas fa-flag-checkered text-rose-500 text-lg"></div>
                    <div v-else-if="n > currentStep" class="dot"></div>
                </div>
            </div>

            <div class="w-full grid grid-cols-3 gap-4 text-sm px-2 bg-slate-50/80 rounded-2xl py-5 border border-slate-100">
                <div class="text-center">
                    <div class="text-emerald-500 font-black text-xl">{{ lostJin }}</div>
                    <div class="text-xs text-slate-400 font-medium mt-1">å·²å‡ (æ–¤)</div>
                </div>
                <div class="text-center border-x border-slate-200">
                    <div class="text-amber-500 font-black text-xl">{{ progress }}%</div>
                    <div class="text-xs text-slate-400 font-medium mt-1">æ€»è¿›åº¦</div>
                </div>
                <div class="text-center">
                    <div class="text-rose-500 font-black text-xl">{{ remainJin }}</div>
                    <div class="text-xs text-slate-400 font-medium mt-1">å‰©ä½™ (æ–¤)</div>
                </div>
            </div>
        </div>

        <!-- å³ä¾§ï¼šæ“ä½œåŒº -->
        <div class="lg:col-span-7 flex flex-col gap-6">
            
            <!-- å½•å…¥åŒº -->
            <div class="glass rounded-3xl p-6 border border-white">
                <h3 class="text-sm font-bold text-slate-400 mb-4 uppercase tracking-wide flex items-center gap-2">
                    <i class="fas fa-pen-fancy"></i> ä»Šæ—¥æ‰“å¡
                </h3>
                <div class="flex flex-col gap-3">
                    <div class="flex gap-3">
                        <input type="date" v-model="input.date" class="input-light rounded-xl px-4 py-3 text-sm w-1/3 font-bold text-slate-600 shadow-sm">
                        <input type="number" v-model.number="input.weight" placeholder="ä½“é‡" class="input-light rounded-xl px-4 py-3 text-sm w-1/3 font-bold shadow-sm">
                        <input type="number" v-model.number="input.cost" placeholder="èŠ±è´¹" class="input-light rounded-xl px-4 py-3 text-sm w-1/3 font-bold shadow-sm">
                    </div>
                    <input type="text" v-model="input.note" @keyup.enter="addRecord" placeholder="å¤‡æ³¨ (å¦‚: èšé¤/è¿åŠ¨/ç”Ÿç†æœŸ) - å›è½¦ä¿å­˜" class="w-full input-light rounded-xl px-4 py-3 text-sm font-medium shadow-sm">
                </div>
                
                <button @click="addRecord" :disabled="loading" class="w-full mt-4 bg-slate-800 hover:bg-slate-700 text-white py-3.5 rounded-xl font-bold transition flex justify-center items-center gap-2 shadow-lg shadow-slate-300/50 transform active:scale-[0.99]">
                    <i class="fas" :class="loading ? 'fa-spinner fa-spin' : 'fa-plus'"></i>
                    {{ loading ? 'æ­£åœ¨åŒæ­¥...' : 'è®°å½•å¹¶åŒæ­¥' }}
                </button>
            </div>

            <div class="glass rounded-3xl p-5 h-64 relative border border-white">
                <div id="chart" class="w-full h-full"></div>
                <div v-if="records.length === 0" class="absolute inset-0 flex items-center justify-center text-slate-400 text-sm font-medium">
                    æš‚æ— æ•°æ®ï¼Œè¯·æ·»åŠ æˆ–å¯¼å…¥
                </div>
            </div>

            <!-- å†å²è®°å½•åˆ—è¡¨ -->
            <div class="glass rounded-3xl p-6 flex-1 overflow-hidden flex flex-col min-h-[300px] border border-white">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-sm font-bold text-slate-400 uppercase tracking-wide">å†å²è®°å½•</h3>
                    <span class="bg-slate-100 text-slate-500 text-xs px-2 py-1 rounded-md font-bold">{{ records.length }} æ¡</span>
                </div>
                <div class="overflow-y-auto pr-2 custom-scroll flex-1">
                    <table class="w-full text-sm text-left text-slate-600">
                        <thead>
                            <tr class="text-xs text-slate-400 border-b border-slate-100">
                                <th class="pb-3 pl-2 w-24">æ—¥æœŸ</th>
                                <th class="pb-3 w-16">ä½“é‡</th>
                                <th class="pb-3 w-16">å˜åŒ–</th>
                                <th class="pb-3">å¤‡æ³¨</th> <!-- ç‹¬ç«‹å¤‡æ³¨åˆ— -->
                                <th class="pb-3 text-right pr-2 w-10">æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr v-for="(r, i) in sortedRecords" :key="i" class="border-b border-slate-50 hover:bg-slate-50 transition group">
                                <td class="py-3 pl-2 font-mono text-slate-500 align-middle">{{ r.date }}</td>
                                <td class="py-3 font-bold text-slate-800 align-middle">{{ r.weight }}</td>
                                <td class="py-3 font-bold align-middle">
                                    <span :class="getDiffColor(r.weight)" class="px-2 py-1 rounded text-xs bg-opacity-10 whitespace-nowrap">
                                        {{ getDiffText(r.weight) }}
                                    </span>
                                </td>
                                <!-- å¤‡æ³¨å†…å®¹ -->
                                <td class="py-3 text-xs text-slate-500 align-middle">
                                    <div class="truncate max-w-[120px] sm:max-w-[200px]" :title="r.note">
                                        {{ r.note || '-' }}
                                    </div>
                                </td>
                                <td class="py-3 text-right pr-2 align-middle">
                                    <button @click="deleteRecord(r)" class="text-slate-300 hover:text-rose-500 transition opacity-0 group-hover:opacity-100">
                                        <i class="fas fa-trash-alt"></i>
                                    </button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
const { createApp } = Vue;

createApp({
    data() {
        return {
            loading: false,
            showConfig: false,
            msg: '',
            msgType: 'info',
            config: {
                token: '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', 
                gistId: 'bad89a736eb73d5165930e216d568ce4',       
                start: 80,
                target: 65
            },
            input: {
                date: new Date().toISOString().split('T')[0],
                weight: '',
                cost: '',
                note: '' 
            },
            records: [],
            chart: null
        }
    },
    computed: {
        sortedRecords() {
            return [...this.records].sort((a, b) => new Date(b.date) - new Date(a.date));
        },
        timelineRecords() {
            return [...this.records].sort((a, b) => new Date(a.date) - new Date(b.date));
        },
        currentWeight() {
            return this.records.length ? this.timelineRecords[this.timelineRecords.length-1].weight : this.config.start;
        },
        lostJin() {
            return ((this.config.start - this.currentWeight) * 2).toFixed(1);
        },
        remainJin() {
            let v = (this.currentWeight - this.config.target) * 2;
            return v > 0 ? v.toFixed(1) : 0;
        },
        progress() {
            const total = this.config.start - this.config.target;
            const lost = this.config.start - this.currentWeight;
            if(total <= 0) return 100;
            let p = (lost / total) * 100;
            return Math.min(100, Math.max(0, p)).toFixed(1);
        },
        currentStep() {
            return Math.floor(this.progress);
        },
        predictedDate() {
            const recs = this.timelineRecords;
            if(recs.length < 2) return 'æ•°æ®ä¸è¶³';
            const first = recs[0];
            const last = recs[recs.length - 1];
            const totalDays = (new Date(last.date) - new Date(first.date)) / (1000 * 3600 * 24);
            const totalLost = first.weight - last.weight;
            if(totalDays <= 0 || totalLost <= 0) return 'è®¡ç®—ä¸­...';
            const dailyRate = totalLost / totalDays;
            const remaining = last.weight - this.config.target;
            if(remaining <= 0) return 'å·²è¾¾æˆ!';
            const daysNeeded = remaining / dailyRate;
            if(daysNeeded > 1000) return 'éœ€é•¿æœŸåšæŒ';
            const targetDate = new Date();
            targetDate.setDate(targetDate.getDate() + daysNeeded);
            return targetDate.toISOString().split('T')[0];
        }
    },
    mounted() {
        const saved = localStorage.getItem('pacman_github_auth');
        if(saved) {
            const parsed = JSON.parse(saved);
            this.config.token = parsed.token || this.config.token;
            this.config.gistId = parsed.gistId || this.config.gistId;
        }
        if(this.config.token && this.config.gistId) {
            this.pullData();
        } else {
            this.showConfig = true;
        }
        this.$nextTick(() => this.initChart());
        window.addEventListener('resize', () => this.chart && this.chart.resize());
    },
    methods: {
        notify(text, type='success') {
            this.msg = text;
            this.msgType = type;
            setTimeout(() => this.msg = '', 3000);
        },
        toggleConfig() { this.showConfig = !this.showConfig; },
        
        getDiffText(weight) {
            const diff = weight - this.config.start;
            return diff > 0 ? `+${diff.toFixed(1)}` : diff.toFixed(1);
        },
        getDiffColor(weight) {
            const diff = weight - this.config.start;
            if(diff === 0) return 'text-slate-400 bg-slate-100';
            return diff < 0 ? 'text-emerald-600 bg-emerald-100' : 'text-rose-500 bg-rose-100';
        },

        async saveConfigAndPush() {
            localStorage.setItem('pacman_github_auth', JSON.stringify({ token: this.config.token, gistId: this.config.gistId }));
            this.showConfig = false;
            if(this.records.length === 0) {
                this.notify('æœ¬åœ°æ— æ•°æ®ï¼è¯·å…ˆç‚¹å‡»"ä»…æ‹‰å–"é˜²æ­¢è¦†ç›–äº‘ç«¯', 'error');
                this.showConfig = true;
                return;
            }
            this.notify('é…ç½®å·²æ›´æ–°ï¼Œæ­£åœ¨åŒæ­¥...');
            await this.pushData();
        },

        async pullData() {
            if(!this.config.token || !this.config.gistId) {
                this.notify('è¯·å…ˆå¡«å†™ Token å’Œ ID', 'error');
                return;
            }
            this.loading = true;
            try {
                const res = await fetch(`https://api.github.com/gists/${this.config.gistId}`, {
                    headers: { 'Authorization': `token ${this.config.token}` },
                    cache: 'no-store'
                });
                if(!res.ok) throw new Error('è¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥Token/ID');
                const data = await res.json();
                const file = data.files['data.json'];
                if(file) {
                    const json = JSON.parse(file.content);
                    if(Array.isArray(json)) {
                        this.records = json;
                    } else {
                        this.records = json.records || [];
                        if(json.meta) {
                            this.config.start = json.meta.start || this.config.start;
                            this.config.target = json.meta.target || this.config.target;
                        }
                    }
                    this.initChart();
                    this.notify('äº‘ç«¯æ•°æ®æ‹‰å–æˆåŠŸ');
                } else {
                    this.notify('äº‘ç«¯æ–‡ä»¶ä¸ºç©ºæˆ–ä¸å­˜åœ¨', 'error');
                }
            } catch(e) {
                this.notify(e.message, 'error');
            } finally {
                this.loading = false;
            }
        },

        async pushData() {
            if(!this.config.token || !this.config.gistId) return;
            if(this.records.length === 0) {
                if(!confirm("âš ï¸ è­¦å‘Šï¼šæœ¬åœ°æ²¡æœ‰ä»»ä½•æ•°æ®ï¼\nç»§ç»­åŒæ­¥å°†ä¼šæ¸…ç©ºäº‘ç«¯çš„æ‰€æœ‰è®°å½•ã€‚\n\nç¡®å®šè¦ç»§ç»­å—ï¼Ÿ")) return;
            }
            this.loading = true;
            try {
                const fullData = {
                    meta: { start: this.config.start, target: this.config.target, updatedAt: new Date().toISOString() },
                    records: this.records
                };
                const payload = { files: { "data.json": { content: JSON.stringify(fullData, null, 2) } } };
                const res = await fetch(`https://api.github.com/gists/${this.config.gistId}`, {
                    method: 'PATCH',
                    headers: { 'Authorization': `token ${this.config.token}`, 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                if(!res.ok) throw new Error('ä¸Šä¼ å¤±è´¥');
                this.notify('å·²åŒæ­¥è‡³äº‘ç«¯');
            } catch(e) {
                this.notify(e.message, 'error');
            } finally {
                this.loading = false;
            }
        },

        handleExcelUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            this.loading = true;
            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const workbook = XLSX.read(e.target.result, { type: 'binary' });
                    const rows = XLSX.utils.sheet_to_json(workbook.Sheets[workbook.SheetNames[0]], { header: 1 });
                    
                    let dateIdx = -1, weightIdx = -1, costIdx = -1, noteIdx = -1;
                    let headerRowIndex = 0;

                    for(let i=0; i<Math.min(5, rows.length); i++) {
                        const rowStr = rows[i].join(' ').toLowerCase();
                        if(rowStr.includes('date') || rowStr.includes('æ—¥æœŸ')) {
                            headerRowIndex = i;
                            rows[i].forEach((cell, idx) => {
                                const txt = String(cell).trim().toLowerCase();
                                if(txt.includes('date') || txt.includes('æ—¥æœŸ')) dateIdx = idx;
                                if(txt.includes('weight') || txt.includes('ä½“é‡')) weightIdx = idx;
                                if(txt.includes('cost') || txt.includes('èŠ±è´¹')) costIdx = idx;
                                if(txt.includes('note') || txt.includes('remark') || txt.includes('å¤‡æ³¨')) noteIdx = idx;
                            });
                            break;
                        }
                    }

                    if(dateIdx === -1 || weightIdx === -1) throw new Error('æœªæ‰¾åˆ°æ—¥æœŸæˆ–ä½“é‡åˆ—');
                    
                    const newMap = new Map();
                    this.records.forEach(r => newMap.set(r.date, r));
                    
                    let count = 0;
                    for(let i = headerRowIndex + 1; i < rows.length; i++) {
                        const row = rows[i];
                        if(!row[dateIdx]) continue;
                        const dateStr = this.parseExcelDate(row[dateIdx]);
                        const weightVal = parseFloat(row[weightIdx]);
                        
                        if(dateStr && !isNaN(weightVal)) {
                            newMap.set(dateStr, {
                                date: dateStr,
                                weight: weightVal,
                                cost: costIdx !== -1 ? (parseFloat(row[costIdx]) || 0) : 0,
                                note: noteIdx !== -1 ? (row[noteIdx] || '') : ''
                            });
                            count++;
                        }
                    }
                    this.records = Array.from(newMap.values());
                    this.notify(`å¯¼å…¥ ${count} æ¡æ•°æ®`);
                    this.initChart();
                    this.pushData();
                } catch (err) {
                    this.notify(err.message, 'error');
                } finally {
                    this.loading = false;
                    event.target.value = '';
                }
            };
            reader.readAsBinaryString(file);
        },

        parseExcelDate(val) {
            if (!val) return null;
            if (typeof val === 'number' && val > 20000) {
                return new Date((val - 25569) * 86400 * 1000).toISOString().split('T')[0];
            }
            const date = new Date(String(val).replace(/\//g, '-').replace(/\./g, '-'));
            return isNaN(date.getTime()) ? null : date.toISOString().split('T')[0];
        },

        async addRecord() {
            if(!this.input.weight) return this.notify('è¯·è¾“å…¥ä½“é‡', 'error');
            const idx = this.records.findIndex(r => r.date === this.input.date);
            const newRecord = { 
                date: this.input.date, 
                weight: this.input.weight, 
                cost: this.input.cost || 0,
                note: this.input.note || '' 
            };
            if(idx > -1) this.records[idx] = newRecord;
            else this.records.push(newRecord);
            
            this.input.note = '';
            this.initChart();
            await this.pushData();
        },

        async deleteRecord(record) {
            if(!confirm('ç¡®å®šåˆ é™¤?')) return;
            this.records = this.records.filter(r => r !== record);
            this.initChart();
            await this.pushData();
        },

        initChart() {
            const dom = document.getElementById('chart');
            if(!dom) return;
            if(!this.chart) this.chart = echarts.init(dom);
            const data = this.timelineRecords;
            this.chart.setOption({
                grid: { top: 20, right: 20, bottom: 20, left: 40, containLabel: true },
                tooltip: { 
                    trigger: 'axis', 
                    backgroundColor: 'rgba(255, 255, 255, 0.95)', 
                    borderColor: '#e2e8f0', 
                    textStyle: {color:'#334155'},
                    extraCssText: 'box-shadow: 0 4px 12px rgba(0,0,0,0.1);',
                    formatter: function(params) {
                        const item = data[params[0].dataIndex];
                        let html = `<div class="font-bold mb-1">${item.date}</div>`;
                        html += `<div>ä½“é‡: <b>${item.weight}</b> kg</div>`;
                        if(item.note) html += `<div class="text-xs text-slate-500 mt-1" style="max-width:150px;white-space:normal;">${item.note}</div>`;
                        return html;
                    }
                },
                xAxis: { 
                    type: 'category', 
                    data: data.map(r => r.date),
                    axisLine: { lineStyle: { color: '#cbd5e1' } },
                    axisLabel: { color: '#64748b' }
                },
                yAxis: { 
                    type: 'value', 
                    scale: true, 
                    splitLine: { lineStyle: { color: '#f1f5f9', type: 'dashed' } },
                    axisLabel: { color: '#94a3b8' }
                },
                series: [{
                    data: data.map(r => r.weight),
                    type: 'line',
                    smooth: true,
                    symbolSize: 8,
                    itemStyle: { color: '#f59e0b', borderColor: '#fff', borderWidth: 2 },
                    lineStyle: { width: 4, color: '#f59e0b', shadowColor: 'rgba(245, 158, 11, 0.3)', shadowBlur: 10 },
                    areaStyle: {
                        color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
                            { offset: 0, color: 'rgba(245, 158, 11, 0.2)' },
                            { offset: 1, color: 'rgba(245, 158, 11, 0)' }
                        ])
                    }
                }]
            });
        }
    }
}).mount('#app');
</script>
</body>
</html>
```
